(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{446:function(t,a,s){t.exports=s.p+"assets/img/result4.67c2e6d0.jpg"},447:function(t,a,s){t.exports=s.p+"assets/img/chart_yolov4_bike.868ab165.png"},448:function(t,a,s){t.exports=s.p+"assets/img/yolov4_post_md.26db798f.gif"},483:function(t,a,s){"use strict";s.r(a);var n=s(2),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"python-google-colab-darknet-yolov4-でバイク検出を学習する"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#python-google-colab-darknet-yolov4-でバイク検出を学習する"}},[t._v("#")]),t._v(" Python + Google Colab + Darknet(Yolov4)でバイク検出を学習する")]),t._v(" "),n("p",[t._v("COCOデータセットから特定のクラスの画像を抽出し，アノテーション情報を整形したので，Darknet(Yolov4)での学習を実施します．"),n("br"),t._v("\n今回はGoogle ColabとGoogle Driveを連携させて，notebook形式で実行してます．"),n("br")]),t._v(" "),n("blockquote",[n("p",[t._v("Google Colaboratory（以下Google Colab）は、Google社が無料で提供している機械学習の教育や研究用の開発環境です。開発環境はJupyter Notebookに似たインターフェースを持ち、Pythonの主要なライブラリがプリインストールされています。"),n("br"),t._v("\n引用元："),n("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("最終的に，Youtubeの"),n("a",{attrs:{href:"https://www.youtube.com/watch?v=wnRH3-CIk4I",target:"_blank",rel:"noopener noreferrer"}},[t._v("平成24年 元旦配達出発式"),n("OutboundLink")],1),t._v("のIDを振り分けるトラッキングも含めたバイクのカウントを実施します．")]),t._v(" "),n("h2",{attrs:{id:"google-colabのファイル構成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#google-colabのファイル構成"}},[t._v("#")]),t._v(" Google Colabのファイル構成")]),t._v(" "),n("p",[t._v("プロジェクトディレクトリはpost_bikeとしています．度々，省略しています．")]),t._v(" "),n("div",{staticClass:"language-init extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("post_bike\n├── /darknet\n│   ├── darknet <- 学習実行ファイル\n│   ├── /backup <- 学習モデルの保存先\n│   │   ├── yolov4_bike_1000.weights\n│   │   ├── yolov4_bike_2000.weights\n│   │   ├── yolov4_bike_3000.weights\n│   │   ├── yolov4_bike_4000.weights\n│   │   ├── yolov4_bike_5000.weights\n│   │   ├── yolov4_bike_best.weights\n│   │   ├── yolov4_bike_last.weights\n│   │   └── yolov4_bike_final.weights\n│   ├── darknet4_bike.zip <- 学習データ解凍前\n│   ├── /darknet4_bike <- 学習データ\n│   ├── chart.png\n│   ├── chart_yolov4_bike.png\n│   ├── darknet_bike_video.py\n│   ├── yolov4.weights\n│   ├── yolov4.conv.137\n│   ├── H240101_post.mp4 <- 元動画\n│   ├── yolov4_post.mp4 <- 検出動画\n│   └── (省略)\n└── darknet4.ipynb <- 実行用ノートブック\n")])])]),n("h2",{attrs:{id:"darknet"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#darknet"}},[t._v("#")]),t._v(" Darknet")]),t._v(" "),n("h3",{attrs:{id:"darknetとは"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#darknetとは"}},[t._v("#")]),t._v(" Darknetとは")]),t._v(" "),n("p",[t._v("C言語で書かれたオープンソースのニューラルネットフレームワークでインストールが容易で試しやすいです．")]),t._v(" "),n("h3",{attrs:{id:"darknetのダウンロード"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#darknetのダウンロード"}},[t._v("#")]),t._v(" darknetのダウンロード")]),t._v(" "),n("p",[t._v("Google ColabとGoogle Driveを連携させて，gitからdarknetをダウンロードします．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Google ColabとGoogle Driveを連携")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("colab "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" drive\ndrive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/drive'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\ncd drive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gitのダウンロード")]),t._v("\ngit clone https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("AlexeyAB"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n")])])]),n("h3",{attrs:{id:"darknetの環境設定"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#darknetの環境設定"}},[t._v("#")]),t._v(" darknetの環境設定")]),t._v(" "),n("p",[t._v("ダウンロードしたdarknetのフォルダに移動して，darknetの設定をイジって環境構築します．"),n("br"),t._v("\nMakefileは以下のように書き換えます．")]),t._v(" "),n("div",{staticClass:"language-ini extra-class"},[n("pre",{pre:!0,attrs:{class:"language-ini"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Makefile")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GPU")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CUDNN")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CUDNN_HALF")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OPENCV")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AVX")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OPENMP")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LIBSO")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v("1")]),t._v("\n")])])]),n("p",[t._v("Makefileを実行してdarknetの環境を整備します．"),n("br"),t._v("\n一度Makefileを実行した後に，Makefileまたは.cファイルを書き換えて変更箇所を反映させたい場合は，"),n("code",[t._v("make clean")]),t._v("で初期化してから再度，Makefileを実行してください．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\ncd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Makefileの実行")]),t._v("\nmake\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Makefileの初期化")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# make clean")]),t._v("\n")])])]),n("p",[t._v("僕の場合は，以下のような中途半端なテキストが帰ってきましたが，環境構築は正常にされていました．")]),t._v(" "),n("div",{staticClass:"language-init extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("~~~~~~~~~~~~~~~~~~~~\nsrc/yolo_console_dll.cpp:201:62: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]\n                 int const max_width_3d = (text_size_3d.width > i.w + 2) ? text_size_3d.width : (i.w + 2);\n                                           ~~~~~~~~~~~~~~~~~~~^~~~~~~~~\nsrc/yolo_console_dll.cpp:183:15: warning: unused variable ‘colors’ [-Wunused-variable]\n     int const colors[6][3] = { { 1,0,1 },{ 0,0,1 },{ 0,1,1 },{ 0,1,0 },{ 1,1,0 },{ 1,0,0 } };\n               ^~~~~~\n")])])]),n("h2",{attrs:{id:"darknetの起動チェック"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#darknetの起動チェック"}},[t._v("#")]),t._v(" darknetの起動チェック")]),t._v(" "),n("p",[t._v("正常に起動するか，デフォルトで入っている画像を検出させてチェックします．")]),t._v(" "),n("h3",{attrs:{id:"初期重みのダウンロード"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初期重みのダウンロード"}},[t._v("#")]),t._v(" 初期重みのダウンロード")]),t._v(" "),n("p",[t._v("正常に起動するか，チェックするために，YOLOv4の学習済みモデルをダウンロードします．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("bash\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\ncd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習済みモデルの重みのダウンロード")]),t._v("\nwget https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("AlexeyAB"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("releases"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet_yolo_v3_optimal"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("O yolov4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights \n")])])]),n("h3",{attrs:{id:"学習済みモデルで検出"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#学習済みモデルで検出"}},[t._v("#")]),t._v(" 学習済みモデルで検出")]),t._v(" "),n("p",[t._v("ダウンロードした学習済みモデルで1つの画像を検出します．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#実行権限を付与")]),t._v("\n!chmod "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 起動チェック")]),t._v("\n!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet detector test cfg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("coco"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data cfg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cfg yolov4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("person"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jpg\n")])])]),n("p",[t._v("person.jpgの検出結果\n"),n("img",{attrs:{src:s(446),alt:""}})]),t._v(" "),n("h2",{attrs:{id:"darknet-yolov4-での学習"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#darknet-yolov4-での学習"}},[t._v("#")]),t._v(" Darknet(Yolov4)での学習")]),t._v(" "),n("p",[t._v("環境構築も確認できたので，Darknet(Yolov4)でバイク検出の学習を実施します．")]),t._v(" "),n("h3",{attrs:{id:"学習データのアップロード"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#学習データのアップロード"}},[t._v("#")]),t._v(" 学習データのアップロード")]),t._v(" "),n("p",[t._v("僕の経験の話になりますが，Google Colabを使う場合は，zip圧縮してからGoogle Driveにアップロードして，Google Colabのノートブック上で解凍させた方がエラーもなく早い感じがするので，ここではそのコードをあげます．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習データの解凍")]),t._v("\n!unzip darknet4_bike"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("zip")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("null\n")])])]),n("h3",{attrs:{id:"学習の実行-yolov4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#学習の実行-yolov4"}},[t._v("#")]),t._v(" 学習の実行(Yolov4)")]),t._v(" "),n("p",[t._v("データの解凍も終わったので，重みの初期値として"),n("code",[t._v("yolov4.conv.137")]),t._v("を使い，学習を実行します．本稿は5000回で学習を終えます．"),n("br"),t._v("\n学習(lossとmap)の様子は，chart_yolov4_bike.pngという画像ファイルで逐次出力されます．"),n("br"),t._v("\nまた，"),n("code",[t._v("-map")]),t._v("というコマンドにより，mapという評価データでどれほど的中しているかを示す数値もchart_yolov4_bike.pngの中に記述されます．"),n("br"),t._v("\ntrain_log.txtとして学習時のログも保存しています．"),n("br"),t._v("\n.cfgファイルと.dataファイルは自作データのものを読み込ませているか確認してください．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 実行権限を付与")]),t._v("\n!chmod "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Yolov4の学習用の初期重み")]),t._v("\n!wget https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("AlexeyAB"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("releases"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet_yolo_v3_optimal"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("137")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("O yolov4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("137")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習の実行(Yolov4)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ドキュメント例：./darknet detector train data/obj.data yolo-obj.cfg yolov4.conv.137  -map")]),t._v("\n!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet detector train darknet4_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4_bike"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data darknet4_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4_bike"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cfg yolov4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("137")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dont_show "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mjpeg_port "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("map")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" backup"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("train_log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt\n")])])]),n("p",[t._v("学習推移\n"),n("img",{attrs:{src:s(447),alt:"学習推移"}})]),t._v(" "),n("h2",{attrs:{id:"検出の実行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#検出の実行"}},[t._v("#")]),t._v(" 検出の実行")]),t._v(" "),n("p",[t._v("学習したモデルでYoutubeの"),n("a",{attrs:{href:"https://www.youtube.com/watch?v=wnRH3-CIk4I",target:"_blank",rel:"noopener noreferrer"}},[t._v("平成24年 元旦配達出発式"),n("OutboundLink")],1),t._v("の検出を実行します．"),n("br"),t._v("\nデフォルトで用意されている"),n("code",[t._v("darknet_video.py")]),t._v("だと描画されるBountingBoxの線が薄い上に，検出スコアの文字が邪魔なので少し改変したコードを実行します．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# darknet_bike_video.py")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" ctypes "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" random\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" os\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" darknet\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" argparse\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" threading "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("enumerate")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" queue "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Queue\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    parser "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" argparse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ArgumentParser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("description"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"YOLO Object Detection"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"video source. If empty, uses webcam 0 stream"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--out_filename"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"inference video name. Not saved if empty"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--weights"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yolov4.weights"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yolo weights path"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--dont_show"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'store_true'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"windown inference display. For headless systems"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--ext_output"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" action"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'store_true'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"display bbox coordinates of detected objects"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--config_file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./cfg/yolov4.cfg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path to config file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--data_file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./cfg/coco.data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path to data file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_argument"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--thresh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("float")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" default"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".25")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("help")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"remove detections with confidence below this value"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("parse_args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("str2int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("video_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    argparse returns and string althout webcam uses int (0, 1 ...)\n    Cast to int if needed\n    """')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("video_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" ValueError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" video_path\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("check_arguments_errors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("thresh "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Threshold should be a float between zero and one (non-inclusive)"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ValueError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Invalid config path {}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("abspath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ValueError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Invalid weight path {}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("abspath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ValueError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Invalid data file path {}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("abspath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" str2int"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("input")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exists"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("input")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ValueError"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Invalid video path {}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("abspath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("input")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_saved_video")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" output_video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    fourcc "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VideoWriter_fourcc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MJPG"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CAP_PROP_FPS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    video "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VideoWriter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("output_video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fourcc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" size"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" video\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("video_capture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" darknet_image_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isOpened"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" frame "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n        frame_rgb "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cvtColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COLOR_BGR2RGB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        frame_resized "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame_rgb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                   interpolation"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("INTER_LINEAR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        frame_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("put"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame_resized"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        img_for_detect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("make_image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("copy_image_from_bytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_for_detect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" frame_resized"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tobytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        darknet_image_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("put"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_for_detect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("release"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("inference")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("darknet_image_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detections_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fps_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isOpened"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        darknet_image "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" darknet_image_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        prev_time "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        detections "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("detect_image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("network"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_names"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" darknet_image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" thresh"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("thresh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        detections_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("put"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        fps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" prev_time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        fps_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("put"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FPS: {}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("print_detections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ext_output"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("free_image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("darknet_image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("release"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bbox2points")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    From bounding box yolo format\n    to corner points cv2 rectangle\n    """')]),t._v("\n    x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" w"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bbox\n    xmin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("round")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    xmax "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("round")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("w "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    ymin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("round")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    ymax "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("round")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" xmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ymin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" xmax"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ymax\n    \n    \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("draw_boxes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" colors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" confidence"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bbox "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" detections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        left"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" right"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bottom "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bbox2points"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rectangle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("left"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("right"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bottom"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# cv2.putText(image, "{} [{:.2f}]".format(label, float(confidence)),')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#             (left, top - 5), cv2.FONT_HERSHEY_SIMPLEX, 0.5,")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#             colors[label], 2)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" image\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("drawing")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detections_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fps_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    random"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("seed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# deterministic bbox colors")]),t._v("\n    video "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" set_saved_video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out_filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isOpened"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        frame_resized "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" frame_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        detections "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" detections_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        fps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fps_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" frame_resized "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            image "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" draw_boxes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" frame_resized"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_colors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            image "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cvtColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COLOR_BGR2RGB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out_filename "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dont_show"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imshow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Inference'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("waitKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),t._v("\n    cap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("release"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("release"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("destroyAllWindows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    frame_queue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    darknet_image_queue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxsize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    detections_queue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxsize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fps_queue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("maxsize"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    args "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" parser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    check_arguments_errors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    network"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_names"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" class_colors "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load_network"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data_file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            batch_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    width "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("network_width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("network"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    height "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" darknet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("network_height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("network"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    input_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" str2int"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("input")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    cap "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("VideoCapture"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("video_capture"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" darknet_image_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("inference"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("darknet_image_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detections_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fps_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("drawing"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("frame_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detections_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fps_queue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("以下のコードをGoogle Colabで実行します．")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MyDrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("post_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("darknet"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 動画での検出(yolov4)")]),t._v("\n!python darknet_bike_video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py \\\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("input")]),t._v(" H240101_post"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mp4 \\\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("out_filename yolov4_post"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mp4 \\\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("weights backup"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4_bike_best"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weights \\\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dont_show \\\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("config_file darknet4_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4_bike"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cfg \\\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("data_file darknet4_bike"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yolov4_bike"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data \\\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("thresh "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("\n")])])]),n("p",[t._v("Darknet(Yolov4)の検出結果"),n("br"),t._v(" "),n("img",{attrs:{src:s(448),alt:"Darknet(Yolov4)の検出結果"}})]),t._v(" "),n("h2",{attrs:{id:"まとめ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),n("p",[t._v("Darknet(Yolov4)でバイク検出の学習を実施しましました．"),n("br"),t._v("\n結構検出できていたので，次は，「keras-yoloでの転移学習」・「DEEPSORTによるトラッキング」・「FastMOTによるトラッキング」・「EfficientDet」を実施します．")]),t._v(" "),n("h2",{attrs:{id:"関連記事"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#関連記事"}},[t._v("#")]),t._v(" 関連記事")]),t._v(" "),n("p",[t._v("前パート："),n("a",{attrs:{href:"https://hirasu1231.github.io/hamlet_engineer/posts/2021/02/24/object-detection03.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Darknet(Yolov4)で学習させるためのcfgファイル等を作成する"),n("OutboundLink")],1),n("br"),t._v("\n次パート：")]),t._v(" "),n("h2",{attrs:{id:"参考サイト"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/AlexeyAB/darknet",target:"_blank",rel:"noopener noreferrer"}},[t._v("AlexeyAB/darknet"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://wakuphas.hatenablog.com/entry/2018/09/19/025941",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colab上でdarknet（YOLO）を使って物体を数える【画像認識】"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://www.ois-yokohama.co.jp/oisblog2018/archives/3673",target:"_blank",rel:"noopener noreferrer"}},[t._v("Darknet+YOLOによる物体検出"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://note.nkmk.me/python-opencv-imread-imwrite/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python, OpenCVで画像ファイルの読み込み、保存（imread, imwrite）"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://note.nkmk.me/python-opencv-draw-function/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Python, OpenCVで図形描画（線、長方形、円、矢印、文字など）"),n("OutboundLink")],1),n("br"),t._v(" "),n("a",{attrs:{href:"https://qiita.com/wMETAw/items/fdb754022aec1da88e6e",target:"_blank",rel:"noopener noreferrer"}},[t._v("FFmpegで動画をGIFに変換"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"エラー集"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#エラー集"}},[t._v("#")]),t._v(" エラー集")]),t._v(" "),n("p",[t._v("実装するまでに発生したエラーを以下にまとめます．")]),t._v(" "),n("h3",{attrs:{id:"エラー1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#エラー1"}},[t._v("#")]),t._v(" エラー1")]),t._v(" "),n("p",[t._v("Makefileを実行すると，以下のようなエラーが発生しました．Google ColabでGPU機能がOFFになっていたので，GPUの設定を見直しました．")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('# エラーメッセージ\n./src/network_kernels.cu(364): warning: variable "l" was declared but never referenced\n\n./src/network_kernels.cu: In function ‘float train_network_datum_gpu(network, float*, float*)’:\n./src/network_kernels.cu:364:7: warning: variable ‘l’ set but not used [-Wunused-but-set-variable]\n         layer l = net.layers[net.n - 1];\n')])])]),n("h3",{attrs:{id:"エラー2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#エラー2"}},[t._v("#")]),t._v(" エラー2")]),t._v(" "),n("p",[t._v("GPUのメモリーオーバーしていましたので．subdivisions(バッチの分割設定)の大きさを変更する．"),n("br"),t._v("\nsubdivisions=8 -> subdivisions=16 -> subdivisions=32")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# エラーメッセージ\n CUDA-version: 10010 (11020), cuDNN: 7.6.5, CUDNN_HALF=1, GPU count: 1  \n OpenCV version: 3.2.0\nmax_batches: Using default '0'\n 0 : compute_capability = 600, cudnn_half = 0, GPU: Tesla P100-PCIE-16GB \n・\n・\n・\nCUDA Error: out of memory: File exists\ndarknet: ./src/utils.c:331: error: Assertion `0' failed.\n")])])]),n("h3",{attrs:{id:"エラー3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#エラー3"}},[t._v("#")]),t._v(" エラー3")]),t._v(" "),n("p",[t._v("libdarknet.soが存在しなかったので，makeの中身をLIBSO=1として環境を整備します．")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("OSError: ./libdarknet.so: cannot open shared object file: No such file or directory\n")])])]),n("h3",{attrs:{id:"エラー4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#エラー4"}},[t._v("#")]),t._v(" エラー4")]),t._v(" "),n("p",[t._v("学習過程のグラフを表示する別画面が表示できないので，Google Colabでは「--dont_show」と表示させないようにします．"),n("br"),t._v("\n「chart_yolov4_bike.png」は保存されるので，大丈夫です．")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("Loading weights from yolov4.conv.137...Done! Loaded 137 layers from weights-file \nUnable to init server: Could not connect: Connection refused\n\n(chart_yolov4_bike.png:526): Gtk-WARNING **: 12:49:27.135: cannot open display\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);