(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{444:function(t,a,s){t.exports=s.p+"assets/img/diablos_black.508d97fa.jpg"},445:function(t,a,s){t.exports=s.p+"assets/img/pretrain_house1.a253f763.png"},446:function(t,a,s){t.exports=s.p+"assets/img/pretrain_house2.ef7adff0.png"},447:function(t,a,s){t.exports=s.p+"assets/img/train_house1.a253f763.png"},448:function(t,a,s){t.exports=s.p+"assets/img/train_house2.c9b314e6.png"},521:function(t,a,s){"use strict";s.r(a);var e=s(2),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"python-cycleganで茶毛のウマをシマウマに変換する"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#python-cycleganで茶毛のウマをシマウマに変換する"}},[t._v("#")]),t._v(" Python + CycleGanで茶毛のウマをシマウマに変換する")]),t._v(" "),e("p",[t._v("本稿では画像生成系のCycleGanを実装し，茶毛のウマをシマウマに変換します．"),e("br"),t._v("\n今回はGoogle ColabとGoogle Driveを連携させて，notebook形式で実行してます．"),e("br")]),t._v(" "),e("blockquote",[e("p",[t._v("Google Colaboratory（以下Google Colab）は、Google社が無料で提供している機械学習の教育や研究用の開発環境です。開発環境はJupyter Notebookに似たインターフェースを持ち、Pythonの主要なライブラリがプリインストールされています。"),e("br"),t._v("\n引用元："),e("a",{attrs:{href:"https://interface.cqpub.co.jp/ail01/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Colabの使い方"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("最終的に，実写モンハンのディアブロス亜種を原種に戻す試みをします．\n"),e("img",{attrs:{src:s(444),alt:""}})]),t._v(" "),e("h2",{attrs:{id:"作業ディレクトリのファイル構成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#作業ディレクトリのファイル構成"}},[t._v("#")]),t._v(" 作業ディレクトリのファイル構成")]),t._v(" "),e("p",[t._v("プロジェクトディレクトリはdiablos_ganとしています．度々，省略しています．")]),t._v(" "),e("div",{staticClass:"language-init extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("diablos_gan\n├── /pytorch-CycleGAN-and-pix2pix\n│   ├── /checkpoints <- 学習モデルの保存先\n│   │   └── /horse2zebra\n│   │       └── latest_net_G.pth <- 学習モデル\n│   │   └── /horse2zebra_pretrained\n│   │       └── latest_net_G.pth <- 学習済みモデル\n│   ├── /results <- 出力される変換画像\n│   │   └── /horse2zebra\n│   │   └── /horse2zebra_pretrained\n│   ├── /datasets <- 学習データ\n│   │   └── /horse2zebra\n│   ├── /scripts <- モデルのダウンロード\n│   │   └── download_cyclegan_model.sh\n│   ├── /datasets <- データセットのダウンロード\n│   │   └── download_cyclegan_dataset.sh\n│   ├── requirements.txt\n│   ├── train.py\n│   ├── test.py\n│   └── (省略)\n└── diablos_gan.ipynb <- 実行用ノートブック\n")])])]),e("h2",{attrs:{id:"pytorch-cyclegan-and-pix2pix"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pytorch-cyclegan-and-pix2pix"}},[t._v("#")]),t._v(" pytorch-CycleGAN-and-pix2pix")]),t._v(" "),e("h3",{attrs:{id:"pytorch-cyclegan-and-pix2pixのダウンロード"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pytorch-cyclegan-and-pix2pixのダウンロード"}},[t._v("#")]),t._v(" pytorch-CycleGAN-and-pix2pixのダウンロード")]),t._v(" "),e("p",[t._v("Google ColabとGoogle Driveを連携させて，gitから"),e("a",{attrs:{href:"https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix",target:"_blank",rel:"noopener noreferrer"}},[t._v("junyanz/pytorch-CycleGAN-and-pix2pix"),e("OutboundLink")],1),t._v("をダウンロードします．"),e("br")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Google ColabとGoogle Driveを連携")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" google"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("colab "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" drive\ndrive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mount"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/content/drive'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("bash\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\ncd "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("My\\ Drive"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("diablos_gan\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# gitのダウンロード")]),t._v("\ngit clone https"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("//")]),t._v("github"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("junyanz"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pytorch"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("CycleGAN"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("pix2pix"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n")])])]),e("h2",{attrs:{id:"cycleganのデモ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cycleganのデモ"}},[t._v("#")]),t._v(" CycleGANのデモ")]),t._v(" "),e("p",[t._v("起動チェックのため，茶毛ウマ->シマウマ，シマウマ->茶毛ウマへ色を変換する学習済みモデルを実行します")]),t._v(" "),e("h3",{attrs:{id:"学習済みモデルをダウンロード"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#学習済みモデルをダウンロード"}},[t._v("#")]),t._v(" 学習済みモデルをダウンロード")]),t._v(" "),e("p",[t._v("以下のコマンドで，学習済みモデルをダウンロードします．"),e("br"),t._v("\n学習済みモデルは， "),e("code",[t._v("./checkpoints/horse2zebra_pretrained/latest_net_G.pth")]),t._v("として格納されています．")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ディレクトリの移動")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v("cd "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("content"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("drive"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("My\\ Drive"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("diablos_gan"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("pytorch"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("CycleGAN"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("pix2pix\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習済みモデルをダウンロード")]),t._v("\n!bash "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scripts"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download_cyclegan_model"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh horse2zebra\n")])])]),e("h3",{attrs:{id:"データセットをダウンロード"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#データセットをダウンロード"}},[t._v("#")]),t._v(" データセットをダウンロード")]),t._v(" "),e("p",[t._v("以下のコマンドで，シマウマと茶毛ウマのデータセットをダウンロードします．"),e("br"),t._v("\nデータセットは，./datasets/horse2zebraに格納されます．"),e("br"),t._v("\ntrainA・testAは茶毛ウマ，trainB・testBはシマウマの画像となっています．")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 現在ディレクトリ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /content/drive/My\\ Drive/diablos_gan/pytorch-CycleGAN-and-pix2pix")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# データセットをダウンロード")]),t._v("\n!bash "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("datasets"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download_cyclegan_dataset"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh horse2zebra\n")])])]),e("h3",{attrs:{id:"モジュールのダウンロード"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#モジュールのダウンロード"}},[t._v("#")]),t._v(" モジュールのダウンロード")]),t._v(" "),e("p",[t._v("以下のコマンドで，モジュールをダウンロードします．"),e("br")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 現在ディレクトリ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /content/drive/My\\ Drive/diablos_gan/pytorch-CycleGAN-and-pix2pix")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# モジュールのダウンロード")]),t._v("\n!pip install "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r requirements"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt\n")])])]),e("h3",{attrs:{id:"デモの実行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#デモの実行"}},[t._v("#")]),t._v(" デモの実行")]),t._v(" "),e("p",[t._v("以下のコマンドで，学習済みモデルからテストを実行します．"),e("br"),t._v("\n--datarootはCucleganで変換するデータセット，--nameは/checkpointsの中で使用したいモデルが格納されているディレクトリ名です．(/checkpoints/ --nameの引数 /latest_net_G.pth)")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 現在ディレクトリ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /content/drive/My\\ Drive/diablos_gan/pytorch-CycleGAN-and-pix2pix")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# デモの実行")]),t._v("\n!python test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dataroot datasets"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("horse2zebra"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("testA \\\n                "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name horse2zebra_pretrained \\\n                "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("model test "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("no_dropout\n")])])]),e("p",[t._v("学習済みモデルでの変換前画像"),e("br"),t._v(" "),e("img",{attrs:{src:s(445),alt:""}})]),t._v(" "),e("p",[t._v("学習済みモデルでの変換後画像"),e("br"),t._v(" "),e("img",{attrs:{src:s(446),alt:""}})]),t._v(" "),e("h2",{attrs:{id:"cycleganの学習"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cycleganの学習"}},[t._v("#")]),t._v(" CycleGANの学習")]),t._v(" "),e("p",[t._v("先ほどダウンロードしたシマウマとウマのデータセットから，CycleGANの学習します．"),e("br"),t._v("\ngoogle colabで実行する場合は，"),e("code",[t._v("--display_id 0")]),t._v("と設定しておかないと学習が途中で止まります．")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 現在ディレクトリ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /content/drive/My\\ Drive/diablos_gan/pytorch-CycleGAN-and-pix2pix")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習実行")]),t._v("\n!python train"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dataroot "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("datasets"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("horse2zebra \\\n                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n_epochs "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" \\\n                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name horse2zebra \\\n                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("model cycle_gan \\\n                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("display_id "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" \\\n                 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("gpu_ids "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),e("h3",{attrs:{id:"学習モデルのテスト"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#学習モデルのテスト"}},[t._v("#")]),t._v(" 学習モデルのテスト")]),t._v(" "),e("p",[t._v("以下のコマンドで学習のテストができます．"),e("br"),t._v("\n--nameでは/checkpointsの中にある学習モデルのディレクトリ名を記述します．"),e("br"),t._v("\n学習モデルの名前は"),e("code",[t._v("latest_net_G.pth")]),t._v("としてください．"),e("br"),t._v("\nAのデータ -> Bのデータに変換するモデルは"),e("code",[t._v("＊＊＊_G_A.pth")]),t._v("で，Bのデータ -> Aのデータに変換するのモデルは"),e("code",[t._v("＊＊＊_G_B.pth")]),t._v("です．"),e("br"),t._v("\n※trainA・testAはウマ，trainB・testBはシマウマの画像となっています．")]),t._v(" "),e("div",{staticClass:"language-python extra-class"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 現在ディレクトリ")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /content/drive/My\\ Drive/diablos_gan/pytorch-CycleGAN-and-pix2pix")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習モデルの名前変更")]),t._v("\n!cp checkpoints"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("horse2zebra"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("latest_net_G_A"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pth checkpoints"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("horse2zebra"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("latest_net_G"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pth\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 学習モデルのテスト実行")]),t._v("\n!python test"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dataroot datasets"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("horse2zebra"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("testA \\\n                "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("name horse2zebra \\\n                "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("results_dir "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("results"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" \\\n                "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("model test "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("no_dropout\n")])])]),e("p",[t._v("学習モデル(50エポック)での変換前画像"),e("br"),t._v(" "),e("img",{attrs:{src:s(447),alt:""}})]),t._v(" "),e("p",[t._v("学習モデル(50エポック)での変換後画像"),e("br"),t._v(" "),e("img",{attrs:{src:s(448),alt:""}})]),t._v(" "),e("h2",{attrs:{id:"まとめ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[t._v("#")]),t._v(" まとめ")]),t._v(" "),e("p",[t._v("画像生成系のCycleGanを実装し，茶毛のウマをシマウマに変換しました．"),e("br"),t._v("\n今度は，ディアブロス亜種->ディアブロスに変換するモデルを実装します．")]),t._v(" "),e("h2",{attrs:{id:"参考サイト"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考サイト"}},[t._v("#")]),t._v(" 参考サイト")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix",target:"_blank",rel:"noopener noreferrer"}},[t._v("junyanz/pytorch-CycleGAN-and-pix2pix"),e("OutboundLink")],1),e("br")])])}),[],!1,null,null,null);a.default=r.exports}}]);